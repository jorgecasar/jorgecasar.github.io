<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Desarrollar Webapps Realtime: Usuarios - Jorge del Casar</title>
  <meta name="author" content="Jorge del Casar">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jorgecasar.github.io/blog/desarrollar-webapps-realtime-usuarios">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Jorge del Casar" type="application/atom+xml">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26360643-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Jorge del Casar</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
                <li >
                    <a href="/repos">Repos</a>
                </li>
                <li >
                    <a href="/talks">Talks</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:jorgecasar.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <article class="hentry" role="article">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-01-16T09:28:14+01:00" pubdate data-updated="true">Jan 16<span>th</span>, 2014</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://jorgecasar.github.io">Comments</a>
        
      </p>
    
    
    <h1 class="entry-title">
        Desarrollar Webapps Realtime: Usuarios
        
    </h1>
    
  </header>


<div class="entry-content clearfix"><div class="alert alert-info">
	<p>Código en GitHub: <a href="https://github.com/jorgecasar/building-realtime-webapp">building-realtime-webapp</a>. Release: <code>users</code>.</p>
	<p>Entorno de desarrollo en Heroku: <a href="http://building-realtime-webapp-dev.herokuapp.com/">building-realtime-webapp</a>.</p>
</div>

<p><img class="center" src="http://sailsjs.org/images/image_squidhome.png" title="Designed for developers by Giant Squid" alt="Giant Squid" /></p>

<ul id="markdown-toc">
  <li><a href="#configuracin-del-almacenamiento">Configuración del almacenamiento</a>    <ul>
      <li><a href="#configuracin-en-heroku">Configuración en Heroku</a></li>
      <li><a href="#admin-ui-para-mongodb">Admin UI para MongoDB</a></li>
    </ul>
  </li>
  <li><a href="#generar-mvc-para-user">Generar MVC para <code>User</code></a>    <ul>
      <li><a href="#probar-bd-y-api">Probar BD y API</a></li>
      <li><a href="#modelo-user">Modelo <code>User</code></a>        <ul>
          <li><a href="#encriptar-contrasea">Encriptar contraseña</a></li>
        </ul>
      </li>
      <li><a href="#controlador-usercontroller">Controlador <code>UserController</code></a></li>
      <li><a href="#vista-user">Vista <code>User</code></a></li>
    </ul>
  </li>
</ul>

<p>Hace unos días vimos <a href="/blog/desarrollar-webapps-realtime-creacion/">cómo crear webapps realtime</a> y hoy vamos a implementar la gestión de usuarios. Podemos hacerlo de forma básica o usando algun middleware como <a href="https://github.com/jaredhanson/passport">Passport</a> o <a href="https://github.com/bnoguchi/everyauth">Everyauth</a>. En este artículo empezaremos creando el controlador y el modelo <code>User</code> y posterior mente haremos la integración con un middleware para ampliar y mejorar la gestión de usuarios.
<!-- more --></p>

<p>Si quieres empezar desde este punto y seguir el manual paso a paso puedes clonar el repositorio desde la release <a href="https://github.com/jorgecasar/building-realtime-webapp/releases/tag/init">init</a>:</p>

<pre><code>$ git clone https://github.com/jorgecasar/building-realtime-webapp.git
$ git checkout init
</code></pre>

<h2 id="configuracin-del-almacenamiento">Configuración del almacenamiento</h2>

<p><img class="pull-right dark" src="http://media.mongodb.org/logo-mongodb.png" title="'MongoDB'" /></p>

<p>Sails proporciona un ORM (Object Relational Mapping) llamado <a href="https://github.com/balderdashy/waterline">Waterline</a> para normalizar las interacciones con modelos. De esta forma nos podemos olvidar del origen de los datos (una vez configurado, claro). Nosotros atacamos al modelo con los métods que veremos a continuación y el waterline se encargará de almacenarlos y recuperarlos del origen. De esta forma especificamos el esquema de nuestra base de datos y podremos utilizar PostgreSQL, MySQL, MongoDB, Memory, Disk, Redis, Riak, IRC, Twitter, JSDom o cualquiera que nos desarrollemos como fuente de nuestros datos.</p>

<p>Nosotros vamos a utiliar <a href="http://www.mongodb.org/">MongoDB</a> para almacenar nuestros datos. Si no tenéis instalado MongoDB podéis consultar el <a href="http://docs.mongodb.org/manual/installation/">manual de instalación de MongoDB</a>. Después tenemos que incluir el paquete de node <code>sails-mongo</code>, que nos incluirá el waterline <a href="https://github.com/balderdashy/sails-mongo">sails-mongo</a> y eliminar la dependencia de <code>sails-disk</code>.Añadimos el flag <code>--save</code> para que modifique las dependencias de <code>package.json</code>, añadiendo y quitando, respectivamente:</p>

<pre><code>$ npm install --save sails-mongo
$ npm uninstall --save sails-disk
</code></pre>

<p>Ahora tenemos que pasar por la configuración puesto que por defecto utiliza el Waterline Disk. Abrimos el fichero: <code>confi/adapters.js</code> y añadimos lo siguiente:</p>

<pre><code>'default': 'mongo',
[…]
mongo: {
	module: 'sails-mongo',
	url: process.env.DB_URL, // variable de entorno.
	schema: true
}
</code></pre>

<p>Como véis hemos utilizado una variable de entorno para no exponer nuestros datos de configuración de producción si subimos el código a algún repositorio público.</p>

<p>Todo el proyecto lo vamos subiendo a un entorno en la nube, en mi caso Heroku, así que vamos a ver cómo dar de alta un <em>Add-on</em>:</p>

<h3 id="configuracin-en-heroku">Configuración en Heroku</h3>

<div class="alert alert-success">
	<p>Recomiendo echarle un ojo a la <a href="https://devcenter.heroku.com/articles/config-vars">documentación de Heroku sobre variables de configuración</a>.</p>
</div>

<p>Para añadir complementos a Heroku podmeos hacerlo desde el panel de control de heroku entrando en nuestra aplicación y en la sección recursos hacemos click en <a href="https://addons.heroku.com/?app=building-realtime-webapp-dev">Get Add-ons</a>. Aquí podemos buscar el complemento que necesitamos, en este caso buscando por Mongo nos aparen dos: <a href="https://addons.heroku.com/mongohq#sandbox">MongoHQ</a> y <a href="https://addons.heroku.com/mongolab#sandbox">MongoLab</a>. Como MongoHQ no está disponible en Europa, no nos queda otra que optar por MongoLab. La versión gratuita es muy parecida en ambos y da de sobra para entornos de desarrollo, así que nos facilitan la elección. Al final de la tabla de características encontráis la posibiliad de incluir el complemento a alguna de vuestras aplicaciones y el código para ejecutarlo en consola.</p>

<pre><code>$ heroku addons:add mongolab --app building-realtime-webapp-dev
</code></pre>

<p>Hemos incluido el nombre de la app porque en el directorio tenemos 2 aplicaciones Heroku, la de producción y la de desarrollo, así que de momento lo incluímos en la desarrollo.</p>

<p>Heroku nos incluye una variable de entorno con la cadena de conexión a la base de datos llamada <code>MONGOLAB_URI</code>, podemos usar esa directamente en nuestro <code>adapter.js</code> o bien crearnos la que habíamos elegido, <code>DB_URL</code>. Para obtener la url podemos copiar la que nos incluye Heroku y luego añadir la nuestra:</p>

<pre><code>$ heroku config --app building-realtime-webapp-dev
MONGOLAB_URI: mongodb://[user]:[password]@[host]:[port]/[database]
$ heroku config:set DB_URL=mongodb://[user]:[password]@[host]:[port]/[database] --app building-realtime-webapp-dev
</code></pre>

<p>Podemos sobrescribir esta configuración para que nos funcione en local modificando el fichero <code>config/local.js</code>. La configuración pude hacerse indicando cada una de los atributos por separado o mediante la <a href="http://docs.mongodb.org/manual/reference/connection-string/">cadena de conexión</a> que aglutina todos los atributos en un solo script.</p>

<pre><code>adapters: {
	'default': 'mongo',
	mongo: {
		module: 'sails-mongo',
		// Config by parts. Sails will generate the connection uri
		host: 'localhost',
		user: '',
		password: '',
		database: 'building-realtime-webapp',
		schema: true
		// Config by connection URI.
		// url: mongodb://localhost/building-realtime-webapp
	}
}
</code></pre>

<p>Antes de seguir, vamos a comprobar que todo funciona correctamente. Debemos abrir 2 consolas para:</p>

<ul>
  <li>
    <p>El demonio de MongoDB:</p>

    <pre><code>  $ mongod
  all output going to: /usr/local/var/log/mongodb/mongo.log
</code></pre>
  </li>
  <li>
    <p>Levantar el proyecto, como ya sabemos: <code>$ sails lift</code> o `$ foreman start</p>
  </li>
</ul>

<div class="alert alert-info">
	<p>Commit en GitHub: <a href="https://github.com/jorgecasar/building-realtime-webapp/commit/5f34185918b05b3648f14213f23ae32b88404262">5f34185918: Config MongoDB as default adapter</a>.</p>
</div>

<h3 id="admin-ui-para-mongodb">Admin UI para MongoDB</h3>
<p>MongoDB no incluye por defecto ningún administrador de bases de datos visual. Con el comando <code>mongo</code> entramos en la consola de MongoDB y podemos realizar consultas. Como no tenemos ningún modelo, Sails todavía no ha crado la base de datos ni las colecciones, así que no os asustéis si véis la base de datos vacía.</p>

<p>Personalmente, opino que la línea de comandos está muy bien y recomiendo que siempre le echéis un ojo y la conozcáis antes de pasar a herramientas con Interfaz de Usuario. En <a href="http://docs.mongodb.org/ecosystem/tools/administration-interfaces/">Mongo Administration Interfaces</a> tenéis unas cuantas herramientas. Para visualizar la base de datos suelo usar <a href="http://genghisapp.com/">Genghis</a> y si voy a tener que administrarla, haciendo consultas, exportaciones, etc… uso <a href="https://github.com/fotonauts/MongoHub-Mac">MongoHub</a>.</p>

<h2 id="generar-mvc-para-user">Generar MVC para <code>User</code></h2>

<p>Sails.js ofrece una serie de generadores como ya vimos en el artículo anterior y esta vez vamos a utilizar el generador de modelo y controlador. Si quisiéramos sólo crear el modelo o el controllador especificaríamos <code>model</code> o <code>controlller</code> después de <code>generate</code>, respectivamente. Pero en este caso necesitaremos ambos:</p>

<pre><code>$ sails generate user
info: Generating model and controller for user...
</code></pre>

<p>Si nos fijamos en el directorio <code>/api</code> veremos que contiene las siguientes carpetas:</p>

<ul>
  <li>adapters</li>
  <li>controllers</li>
  <li>models</li>
  <li>policies</li>
  <li>services</li>
</ul>

<p>Como os podéis imaginar el comando anterior nos ha creado los ficheros <code>/api/models/User.js</code> y <code>/api/controllers/UserController.js</code>.</p>

<p>Sails por defecto tiene una serie de blueprints, todos activados por defecto.</p>

<ul>
  <li>Action: Todas las acciones creadas en el controlador serán accesibles mediante la url: <code>/&lt;controller&gt;/&lt;action&gt;</code>.
    <ul>
      <li>/user -&gt; UserController.index</li>
      <li>/user/index -&gt; UserController.index</li>
      <li>/user/sendEmail -&gt; UserController.sendEmail</li>
      <li>/user/[action] -&gt; UserController[action]</li>
    </ul>
  </li>
  <li>REST: Expone un API REST convencional por encima del controlador con las acciones: <code>find</code>, <code>create</code>, <code>update</code>, and <code>destroy</code> asociados a sus respectivos verbos:
    <ul>
      <li>GET -&gt; /user/:id? -&gt; UserController.find</li>
      <li>POST -&gt; /user -&gt; UserController.create</li>
      <li>PUT -&gt; /user/:id -&gt; UserController.update</li>
      <li>DELETE -&gt; /user/:id -&gt; UserController.destroy</li>
    </ul>
  </li>
  <li>Shortcuts: Nos permite acceder a los <em>métods CRUD</em> (Create, Read, Update y Delete) desde la barra de direcciones del navegador:
    <ul>
      <li>/user/find/[id] -&gt; Devuelve la información del usuario con id = [id]</li>
      <li>/user/create?name=<name> -&gt; Crea un nuevo usuario</name></li>
      <li>/user/update/[id]?name=<newname> -&gt; Actualiza el nombre del usuario con id = [id]</newname></li>
      <li>/user/delete/[id] -&gt; Elimina el usuario con id = [id]</li>
    </ul>
  </li>
</ul>

<p>Todas estas acciones podemos dejarlas activadas en desarrollo para facilitarlos algunas tareas. Pero en el entorno de producción, las acciones y el API REST podemos dejarlos activados, pero los atajos habrá que deshabilitarlos. Esta configuración puedes modificarla en cada <em>Controller</em> o de manera global en <code>config/controllers.js</code>.</p>

<h3 id="probar-bd-y-api">Probar BD y API</h3>
<p>Ahora si volvemos a lanzar nuestro servidor (<code>sails lift</code>) podemos realizar algunas pruebas y ver la potencia de Sails recién salido de la caja. La primera es comprobar que la base de datos se ha crado correctamente.</p>

<ul>
  <li>
    <p>Por línea de comandos:</p>

    <pre><code>  $ mongo
  &gt; use building-realtime-webapp
  switched to db building-realtime-webapp
  &gt; show collections
  system.indexes
  user
</code></pre>
  </li>
  <li>
    <p>Con Genghis:</p>

    <pre><code>  $ genghisapp
  Starting 'genghisapp'...
  'genghisapp' is already running at http://0.0.0.0:5678
</code></pre>

    <p>Entramos en <a href="http://0.0.0.0:5678">http://0.0.0.0:5678</a> y navegamos por nuestro servidor <a href="http://0.0.0.0:5678/servers/localhost">localhost</a> &gt; <a href="http://0.0.0.0:5678/servers/localhost/databases/building-realtime-webapp">building-realtime-webapp</a> &gt; <a href="http://0.0.0.0:5678/servers/localhost/databases/building-realtime-webapp/collections/user">user</a></p>
  </li>
</ul>

<p>Parece que todo funciona, ahora le toca el turno a los <em>blueprints</em>. Antes de probar las siguientes URLs, debéis hacer un cambio en <code>config/local.js</code> y poner a <code>schema: false</code>. Esto hará que no tengamos un esquema de la base de datos definido y podamos introductir cualquier atributo a la colección. Con <code>schema: true</code>, sólo se guradarán los atributos que hayamos definido en <code>/api/models/User.js</code>. Os recomiendo que probéis a cambiar la configuración de los <em>blueprints</em> en <code>config/controllers</code> y la del esquema para ver las diferentes configuraciones y podáis entender qué sucede con nuestro velero. Recordad que hay que alzar las velas (<code>sails lift</code>) con cada cambio de configuración.</p>

<ul>
  <li>Mostrar la lista de usuarios: <a href="http://localhost:1337/user">http://localhost:1337/user</a>.</li>
  <li>Añadir el usuario “Jorge”: <a href="http://localhost:1337/user/create?name=Jorge">http://localhost:1337/user/create?name=Jorge</a>.</li>
  <li>Buscar el usuarios con nombre “Jorge”: <a href="http://localhost:1337/user?name=Jorge">http://localhost:1337/user?name=Jorge</a>.</li>
  <li>Modificar el usuario “Jorge” (usar el id de la consulta anterior): <a href="http://localhost:1337/user/update/[id]?name=Jorge del Casar">http://localhost:1337/user/update/[id]?name=Jorge del Casar</a></li>
</ul>

<div class="alert alert-info">
	<p>Commit en GitHub: <a href="https://github.com/jorgecasar/building-realtime-webapp/commit/153a53883a8a4c209ac3a5aa3bc8f0e6f9633eba">153a53883a: Create Model and Controller for User</a>.</p>
</div>

<h3 id="modelo-user">Modelo <code>User</code></h3>

<div class="alert alert-success">
	<p>Recomiendo echarle un ojo a la <a href="http://sailsjs.org/#!documentation/models">Documentación de Sails sobre Modelos</a>.</p>
</div>

<p>En el archivo <code>/api/model/User.js</code> especificamos los atributos necesarios. Empezaremos simplemente con email y contraseña:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>User Model</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">attributes</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">email</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">			<span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
</span><span class="line">			<span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class="line">			<span class="nx">email</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class="line">			<span class="nx">unique</span><span class="o">:</span> <span class="kc">true</span>
</span><span class="line">		<span class="p">},</span>
</span><span class="line">		<span class="nx">password</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">			<span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
</span><span class="line">			<span class="nx">required</span><span class="o">:</span> <span class="kc">true</span>
</span><span class="line">		<span class="p">}</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Salis nos permite crear nuestros propios métodos y sobrescribir los métodos <code>toObject</code> y <code>toJSON</code> (se especifican en attributes). Veamos un ejemplo de ambos para evitar que la contraseña llegue al cliente:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>User Model</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">attributes</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">	<span class="p">[</span><span class="err">…</span><span class="p">]</span>
</span><span class="line">	<span class="c1">// Override toJSON instance method to remove password value</span>
</span><span class="line">	<span class="nx">toJSON</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">		<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">toObject</span><span class="p">();</span>
</span><span class="line">		<span class="k">delete</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">password</span><span class="p">;</span>
</span><span class="line">		<span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Ahora si volvemos a levantar el servidor y probamos introducir un nuevo usuario: <a href="http://localhost:1337/user/create?email=someone@somewhere.com&amp;password=securePass007">http://localhost:1337/user/create?email=someone@somewhere.com&amp;password=securePass007</a>. Vemos que el JSON que nos devuelve el servidor no incluye el atributo password, pero si visualizamos la base de datos (<a href="http://localhost:5678/servers/localhost/databases/building-realtime-webapp/collections/user">http://localhost:5678/servers/localhost/databases/building-realtime-webapp/collections/user</a>, vemos que si se ha guardado correctamente.</p>

<h4 id="encriptar-contrasea">Encriptar contraseña</h4>
<p>Guardar la contraseña directamente en la base de datos es una mala práctica, así que vamos a ver cómo encriptarla usando el paquete <code>bcrypt</code>. Instalamos y guardamos la dependencia ejecutando:</p>

<pre><code>$ npm install --save bcrypt
</code></pre>

<p>Sails nos ofrece una serie de <em>callbacks</em> del ciclo de vida del modelo para que podamos unirnos en cualquier parte del proceso de la consulta:</p>

<ul>
  <li>Callbacks al crear:
    <ul>
      <li>beforeValidation: <code>fn(values, cb)</code></li>
      <li>beforeCreate: <code>fn(values, cb)</code></li>
      <li>afterCreate: <code>fn(newlyInsertedRecord, cb)</code></li>
    </ul>
  </li>
  <li>Callbacks al actualizar:
    <ul>
      <li>beforeValidation: <code>fn(valuesToUpdate, cb)</code></li>
      <li>beforeUpdate: <code>fn(valuesToUpdate, cb)</code></li>
      <li>afterUpdate: <code>fn(updatedRecord, cb)</code></li>
    </ul>
  </li>
  <li>Callbacks al eliminar:
    <ul>
      <li>beforeDestroy: <code>fn(criteria, cb)</code></li>
      <li>afterDestroy: <code>fn(cb)</code></li>
    </ul>
  </li>
</ul>

<p>En nuestro caso necesitamos ejecutarla al crear, aunque más adelante tendremos que dar la posibilidad al usuario de actualizar su contraseña y por tanto debemos encriptarla al actualizar también:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>User Model</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">module</span><span class="p">.</span><span class="kr">export</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">	<span class="p">[</span><span class="err">…</span><span class="p">]</span>
</span><span class="line">	<span class="c1">// Lifecycle Callbacks</span>
</span><span class="line">	<span class="nx">beforeCreate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">values</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">hashPassword</span><span class="p">(</span><span class="nx">values</span><span class="p">,</span> <span class="nx">next</span><span class="p">);</span>
</span><span class="line">	<span class="p">},</span>
</span><span class="line">	<span class="nx">beforeUpdate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">values</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">		<span class="k">if</span><span class="p">(</span><span class="nx">values</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span> <span class="nx">hashPassword</span><span class="p">(</span><span class="nx">values</span><span class="p">,</span> <span class="nx">next</span><span class="p">);</span>
</span><span class="line">		<span class="k">else</span> <span class="nx">next</span><span class="p">();</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line"><span class="p">};</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">bcrypt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bcrypt&#39;</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="kd">function</span> <span class="nx">hashPassword</span><span class="p">(</span><span class="nx">values</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">bcrypt</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">values</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">		<span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span><span class="line">
</span><span class="line">		<span class="nx">values</span><span class="p">.</span><span class="nx">password</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">;</span>
</span><span class="line">		<span class="nx">next</span><span class="p">();</span>
</span><span class="line">	<span class="p">});</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Ahora si volvemos a levantar el servidor y probamos introducir un nuevo usuario: <a href="http://localhost:1337/user/create?email=other@somewhere.com&amp;password=securePass007">http://localhost:1337/user/create?email=other@somewhere.com&amp;password=securePass007</a>. Vemos que la contraseña es una cadena de caracteres inlegible (<a href="http://localhost:5678/servers/localhost/databases/building-realtime-webapp/collections/user">http://localhost:5678/servers/localhost/databases/building-realtime-webapp/collections/user</a>.</p>

<div class="alert alert-info">
	<p>Commit en GitHub: <a href="https://github.com/jorgecasar/building-realtime-webapp/commit/5137c5a1bb9cc3decb257da5ed6677e804ad487d">153a53883a: Define User Model and include bcryp package</a>.</p>
</div>

<p>En el siguiente commit hemos añadido un método para verificar la contraseña, puesto que lo utilizaremos para comprobar que es correcta cuando queremos cambiarla. También hemos mejorado la callback beforeUpdate añadiendo la lógica necesaria para cambiar la contraseña, verificando que la anterior es correcta y que la nueva se introduce correctamente 2 veces. Por último hemos mejorado el método hashPassword generando un salt previo al hash. Están todas las lineas comentadas así que es fácil ver que se hace en cada una de ellas.</p>

<div class="alert alert-info">
	<p>Commit en GitHub: <a href="https://github.com/jorgecasar/building-realtime-webapp/commit/e881b5cba8996ae883396ecb6c84e3758f984dbc">e881b5cba8: Added method validPassword, improved methods beforeUpdate and hashPassword</a>.</p>
</div>

<div class="alert alert-danger">
	<h5><a href="https://github.com/jorgecasar/building-realtime-webapp/issues/1">Issue #1: Check password beforeValidation instead of beforeUpdate</a>.</h5>
	<p>La contraseña es un atributo obligatorio en en el modelo del usuario, por lo tanto al comprobar la validez de los datos nos saltará un error si no la introducimos. Por ello, las comprobaciones que hacíamos en beforeUpdate hay que hacerlas en beforeValidation para evitar que falle al no introducir contraseña. Además hay que comprobar mediante el id si no esncontramos en una cración o en una actualización de usuario.</p> 
</div>

<h3 id="controlador-usercontroller">Controlador <code>UserController</code></h3>

<div class="alert alert-success">
	<p>Recomiendo echarle un ojo a la <a href="http://sailsjs.org/#!documentation/controllers">Documentación de Sails sobre Controladores</a>.</p>
</div>

<p>Ahora que tenemos nuestro modelo <code>User</code> listo vamos a incluir unas acciones en nuestro <code>UserController</code> que nos permitirán interactuar con nuestros modelos de una forma más avanzada que las acciones por defecto. Se han mantenido las acciones estandar para estar en consonancia con la API REST y los Sortcurs CRUD, para evitar tener que cambiar routes, que ya veremos en siguientes artículos cómo hacerlo.</p>

<ul>
  <li>Acciones REST:
    <ul>
      <li><strong>find</strong>: Atenderá las peticiones <code>GET</code> a <code>/user/:id?</code>. La ‘?’ significa que el parámetro <code>id</code> es opcional. Por lo que el controlador está preparado para buscar un usuario por id o varios en función de lo especificado en el where. Además se podrán limitar, saltar y ordenar los resultados.</li>
      <li><strong>create</strong>: Resolverá las peticiones <code>POST</code> a <code>/user</code>, creando un usuario y devolviendo la instancia creada.</li>
      <li><strong>update</strong>: Se encargará de las peticiones <code>PUT</code> a <code>/user/:id</code>. El parámetro id es obligatorio puesto que no se permite la edición múltiple de usuarios.</li>
      <li><strong>destroy</strong>: Eliminará el usuario con id especificado mediante la petición <code>DELETE</code> a <code>/user/:id</code></li>
    </ul>
  </li>
  <li>Acciones adicionales:
    <ul>
      <li><strong>edit</strong>: Devolverá la vista <code>edit</code>, la cual contendrá el formulario de edición con los valores precargados.</li>
      <li><strong>new</strong>: devolverá la vista <code>new</code> con un formularo para la creación de un nuevo usuario.</li>
    </ul>
  </li>
</ul>

<p>Por no copiar todo el controlador aquí, voy a destacar las parte que me parecen más interesantes, puesto que el resto lo tenéis en GitHub. Vamos a empzar con un fragmento de la acción <code>find</code> que permite, filtrar y paginar los resultados. Gracias a estas 10 lineas podrás hacer consultas a urls como: <a href="http://localhost:1337/user/?where={&quot;email&quot;:{&quot;contains&quot;:&quot;somewhere.com&quot;}}&amp;limit=2&amp;sort=email DESC">http://localhost:1337/user/?where={“email”:{“contains”:”somewhere.com”}}&amp;limit=2&amp;sort=email DESC</a> y obtener como máximo 2 usuarios ordenados de manera descendente cuyos emails contengan “somewhere.com”.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>User Controller</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">find</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="p">[</span><span class="err">…</span><span class="p">]</span>
</span><span class="line">	<span class="c1">// If we have a where param we will pase it as JSON.</span>
</span><span class="line">	<span class="kd">var</span> <span class="nx">where</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;where&#39;</span><span class="p">);</span>
</span><span class="line">	<span class="k">if</span><span class="p">(</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">where</span><span class="p">))</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">where</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">where</span><span class="p">);</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line">	<span class="c1">// Setting options from params.</span>
</span><span class="line">	<span class="kd">var</span> <span class="nx">filters</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">limit</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;limit&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">,</span>
</span><span class="line">		<span class="nx">skip</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;skip&#39;</span><span class="p">)</span>  <span class="o">||</span> <span class="kc">undefined</span><span class="p">,</span>
</span><span class="line">		<span class="nx">sort</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;sort&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">,</span>
</span><span class="line">		<span class="nx">where</span><span class="o">:</span> <span class="nx">where</span> <span class="o">||</span> <span class="kc">undefined</span>
</span><span class="line">	<span class="p">};</span>
</span><span class="line">	<span class="c1">// Find users according with filters</span>
</span><span class="line">	<span class="nx">User</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">filters</span><span class="p">).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="nx">foundUsers</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">users</span><span class="p">){</span>
</span><span class="line">		<span class="p">[</span><span class="err">…</span><span class="p">]</span>
</span><span class="line">	<span class="p">});</span>
</span><span class="line">	<span class="p">[</span><span class="err">…</span><span class="p">]</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Otra parte interesante es la forma de devolver los resultados, ya que antes de hacerlo comprobamos qué tipo de respuesta se nos está solicitando. En caso de solicitar JSON devolvemos los resultados en JSON y en caso contraro le pasamos los resultados a la vista correspondiente.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>User Controller</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="p">[</span><span class="err">…</span><span class="p">]</span>
</span><span class="line"><span class="c1">// Response JSON if needed.</span>
</span><span class="line"><span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">wantsJSON</span><span class="p">)</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
</span><span class="line"><span class="c1">// Else response view with results </span>
</span><span class="line"><span class="k">else</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">view</span><span class="p">({</span> <span class="nx">user</span><span class="o">:</span> <span class="nx">user</span> <span class="p">});</span>
</span><span class="line"><span class="p">[</span><span class="err">…</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="alert alert-info">
	<p>Commit en GitHub: <a href="https://github.com/jorgecasar/building-realtime-webapp/commit/046d2301bf754f4b99c7abeb4b02faf137d4c502">046d2301bf: UsarController: API REST friendly</a>.</p>
</div>

<h3 id="vista-user">Vista <code>User</code></h3>

<div class="alert alert-success">
	<p>Recomiendo echarle un ojo a la <a href="http://sailsjs.org/#!documentation/views">Documentación de Sails sobre vistas</a>.</p>
</div>

<p>Por último, tendremos que crear una vista para mostrar los resultados. Si os fijáis no hemos definido el nombre de la vista ya que Sails asocia por defecto cada acción de un controlador a la vista localizada en <code>/views/[controlador]/[acción]</code>. Sabiendo esto debemos crear el directorio <code>/view/user</code> y los ficheros <code>find.ejs</code>, <code>new.ejs</code> y <code>edit.ejs</code>. El resto de acciones no se reflejarán en una vista por lo cual no las necesitamos.</p>

<p>Antes de enseñar las peculiaridades de las vistas he incluido <a href="http://getbootstrap.com/">Bootstrap</a> y <a href="http://jquery.com/">jQuery</a> (dependencia de Bootstrap) en el directorio <code>/assets/linker/js</code> y los estilos de Bootstrap en <code>assets/linker/styles/</code>. De esta manera se incluyen automáticamente en el layout. Para asegurarnos que el orden es el correcto abrimos el fichero <code>/Gruntfile.js</code> y lo modificamos indicando el orden de inclusión de los recursos:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Gruntfile.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">cssFilesToInject</span> <span class="o">=</span> <span class="p">[</span>
</span><span class="line">	<span class="s1">&#39;linker/styles/bootstrap.css&#39;</span><span class="p">,</span>
</span><span class="line">	<span class="s1">&#39;linker/styles/bootstrap-theme.css&#39;</span><span class="p">,</span>
</span><span class="line">	<span class="s1">&#39;linker/**/*.css&#39;</span>
</span><span class="line"><span class="p">];</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">jsFilesToInject</span> <span class="o">=</span> <span class="p">[</span>
</span><span class="line">	<span class="p">[</span><span class="err">…</span><span class="p">]</span>
</span><span class="line">	<span class="c1">// *-&gt;    put other dependencies here   &lt;-*</span>
</span><span class="line">	<span class="s1">&#39;linker/js/jquery.js&#39;</span><span class="p">,</span>
</span><span class="line">	<span class="s1">&#39;linker/js/bootstrap.js&#39;</span><span class="p">,</span>
</span><span class="line">	<span class="p">[</span><span class="err">…</span><span class="p">]</span>
</span><span class="line"><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class="alert alert-info">
	<p>Commit en GitHub: <a href="https://github.com/jorgecasar/building-realtime-webapp/commit/e3479ce836a6baacd89491d893b43aeacf7d0452">e3479ce836: Include jQuery and Bootstrap. Modify GruntFile to set the order</a>.</p>
</div>

<p>Las vistas en si no tienen mucho misterio. Destacar que Sails utiliza el motor de templates <a href="http://embeddedjs.com/">EJS: Embebed Javascript</a>, lo cual me recuerda mucho a PHP donde puedes mezclar código de scripting con HTML. Afortunadamente, todos sabemos que eso es una mala práctica y hay que dejarle la lógica al controlador y utilizar en las vistas la menor posible. Para este artículo, al no estar dedidaco a las vistas no he querido complicarlas mucho incluyendo partials, cambiando el layout o indicando la vista desde el controlador, pero que sepáis que se puede hacer y ya vermos cómo en otros artículos.</p>

<div class="alert alert-info">
	<p>Commit en GitHub: <a href="https://github.com/jorgecasar/building-realtime-webapp/commit/3785bbe071dcf8cf4ee12cd75ac0ab5570dec342">3785bbe071: Included User views. Modified index and layout. Include some styles to customize Bootstrap</a>.</p>
</div>

<p>Ahora que tenemos todo subido podemos hacer un push al entorno de desarrollo:</p>

<pre><code>$ git push heroku-dev develop:master
</code></pre>

<p>Y por último podemos ver el resultado en <a href="http://building-realtime-webapp-dev.herokuapp.com/">http://building-realtime-webapp-dev.herokuapp.com/</a>:</p>
</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="glyphicon glyphicon-user"></span> <span class="byline author vcard">Posted by <span class="fn">Jorge del Casar</span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-01-16T09:28:14+01:00" pubdate data-updated="true">Jan 16<span>th</span>, 2014</time>
          

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/blog/categories/sailsjs/'>SailsJS</a>
  
</span>


        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://jorgecasar.github.io/blog/desarrollar-webapps-realtime-usuarios/" data-via="jorgecasar" data-counturl="http://jorgecasar.github.io/blog/desarrollar-webapps-realtime-usuarios/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/blog/desarrollar-webapps-realtime-creacion/" title="Previous Post: Desarrollar webapps realtime: Creación">&laquo; Desarrollar webapps realtime: Creación</a></li>
            
            
            <li class="next"><a href="/blog/desarrollar-webapps-realtime-auth/" title="Next Post: Desarrollar Webapps Realtime: Auth">Desarrollar Webapps Realtime: Auth &raquo;</a></li>
            
          </ul>
        
      </footer>
    </article>
    
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
      </section>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/desarrollar-webapps-realtime-auth-con-passport-y-proveedores/">Desarrollar Webapps Realtime: Auth Con Passport Y Proveedores</a>
    
    <a class="list-group-item " href="/blog/desarrollar-webapps-realtime-auth-con-passport/">Desarrollar Webapps Realtime: Auth Con Passport</a>
    
    <a class="list-group-item " href="/blog/desarrollar-webapps-realtime-auth/">Desarrollar Webapps Realtime: Auth</a>
    
    <a class="list-group-item active" href="/blog/desarrollar-webapps-realtime-usuarios/">Desarrollar Webapps Realtime: Usuarios</a>
    
    <a class="list-group-item " href="/blog/desarrollar-webapps-realtime-creacion/">Desarrollar Webapps Realtime: Creación</a>
    
  </div>
</section>

<section class="panel panel-default clearfix">
  <div class="panel-heading">
      <h3 class="panel-title">GitHub Repos</h3>
  </div>
  <div class="list-group" id="gh_repos">
    <p class="loading">Status updating...</p>
  </div>
  
    <div class="gh-profile-link pull-right text-muted">
      <a href="https://github.com/jorgecasar">@jorgecasar</a> on GitHub
    </div>
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jorgecasar',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">On Delicious</h3>
  </div>
  <div class="panel-body">
    <div id="delicious"></div>
    <script type="text/javascript" src="http://feeds.delicious.com/v2/json/jorgecasar?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
    <p><a href="http://delicious.com/jorgecasar">My Delicious Bookmarks &raquo;</a></p>
  </div>
</section>



<section class="googleplus panel panel-default">
  <div class="panel-body">
    <h1>
      <a href="https://plus.google.com/+JorgeDelCasarSanchez?rel=author">
        <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
        Google+
      </a>
    </h1>
  </div>
</section>



    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2014 - Jorge del Casar<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'jorgecasar';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jorgecasar.github.io/blog/desarrollar-webapps-realtime-usuarios/';
        var disqus_url = 'http://jorgecasar.github.io/blog/desarrollar-webapps-realtime-usuarios/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </body>
</html>
