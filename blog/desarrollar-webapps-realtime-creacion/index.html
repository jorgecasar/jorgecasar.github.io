<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Desarrollar webapps realtime: Creación - Jorge del Casar</title>
  <meta name="author" content="Jorge del Casar">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jorgecasar.github.io/blog/desarrollar-webapps-realtime-creacion">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Jorge del Casar" type="application/atom+xml">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26360643-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Jorge del Casar</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
                <li >
                    <a href="/repos">Repos</a>
                </li>
                <li >
                    <a href="/talks">Talks</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:jorgecasar.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <article class="hentry" role="article">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-01-10T10:30:09+01:00" pubdate data-updated="true">Jan 10<span>th</span>, 2014</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://jorgecasar.github.io">Comments</a>
        
      </p>
    
    
    <h1 class="entry-title">
        Desarrollar Webapps Realtime: Creación
        
    </h1>
    
  </header>


<div class="entry-content clearfix"><div class="alert alert-info">
    <p>Código en GitHub: <a href="https://github.com/jorgecasar/building-realtime-webapp">building-realtime-webapp</a>. Release: <code>init</code>.</p>
</div>

<p><img class="center" src="http://sailsjs.org/images/image_squidhome.png" title="Designed for developers by Giant Squid" alt="Giant Squid" /></p>

<ul id="markdown-toc">
  <li><a href="#crear-proyecto-con-sailsjs">Crear proyecto con Sails.js</a>    <ul>
      <li><a href="#requisitos">Requisitos</a></li>
      <li><a href="#instalacin">Instalación</a></li>
      <li><a href="#crear-un-nuevo-proyecto">Crear un nuevo proyecto</a></li>
    </ul>
  </li>
  <li><a href="#crear-un-repositorio-git">Crear un repositorio git</a>    <ul>
      <li><a href="#repositorio-git-remoto-en-github">Repositorio git remoto en GitHub</a></li>
      <li><a href="#primer-commit">Primer commit</a></li>
    </ul>
  </li>
  <li><a href="#despliegue-en-heroku">Despliegue en Heroku</a>    <ul>
      <li><a href="#requisitos-1">Requisitos</a></li>
      <li><a href="#configuracin-local">Configuración local</a></li>
      <li><a href="#crear-una-aplicacin-en-heroku">Crear una aplicación en Heroku</a></li>
      <li><a href="#desplegar-el-cdigo">Desplegar el código</a></li>
    </ul>
  </li>
</ul>

<p>Hace unos meses descubrí Sails.js, un framework MVC para Node basado en Express que te facilita la creación de aplicaciones web realtime mediante Websockets. Así que no me extraña que el slogan sea:</p>
<blockquote><p>THE WEB FRAMEWORK OF YOUR DREAMS.<br />Designed for developers by Giant Squid.</p><footer><strong>Mike McNeil,</strong> <cite><a href="http://sailsjs.org/">Creator of sails.js</a></cite></footer></blockquote>
<!-- more -->

<h2 id="crear-proyecto-con-sailsjs">Crear proyecto con Sails.js</h2>

<h3 id="requisitos">Requisitos</h3>
<p><img class="pull-right dark" src="http://nodejs.org/images/logo.png" title="'Node.js'" />
Obviamente necesitamos tener <a href="http://nodejs.org/">Node.js</a>. En mi caso, tengo la última versión estable, la 0.10.24, puesto que voy a desplegar en Heroku y acepta cualquier versión superior a la 0.8.5. Os recomiendo revisar qué versión hay instalada en el servidor donde vayáis a hacer despliegue de producción. Para comprobar la versión que tienes en local, ejecuta en la consola: <code>node -v</code>. Para gestionar la versión de node os recomiendo el paquete <a href="https://npmjs.org/package/n"><code>n</code> de npm</a>. Lo instalais globalmente para tenerlo disponible desde cualquier parte y luego podrás instalar la versión última versión estable con el comando <code>sudo n stable</code></p>

<h3 id="instalacin">Instalación</h3>
<p>Podemos instalar <a href="http://sailsjs.org/">Sails.js</a> local o globalmente (flag -g)el paquete sails:</p>

<div>
  <pre><code class="plain">$ sudo npm -g install sails</code></pre>
</div>

<h3 id="crear-un-nuevo-proyecto">Crear un nuevo proyecto</h3>
<p>Tenemos que llamar al commando <code>new</code> que nos creará un proyecto sails en la carpeta <code>&lt;appName&gt;</code> en el directorio desde donde lo ejecutemos.</p>

<div>
  <pre><code class="plain">$ sails new &lt;appName&gt; [--linker]
$ cd &lt;appName&gt;</code></pre>
</div>

<p>También existe la opción de usar un enlazador de recursos automático añadiendo la flag <code>--linker</code>. Esto instalará una tarea de <a href="http://gruntjs.com/">Grunt</a> llamada <a href="https://github.com/balderdashy/grunt-sails-linker">grunt-sails-linker</a> que automatiza la adición de etiquetas html basadas en ficheros. Incluyendo la flag sails creará el <code>Gruntfile.js</code> implementando esta tarea de Grunt.</p>

<p>Con el proyecto creado y estando en su directorio podremos lanzarlo:</p>

<div>
  <pre><code class="plain">$ sails lift</code></pre>
</div>

<p>Una vez lanzado, vemos que el barco ha zarpado y podemos ver nuestra webapp en <a href="http://localhost:1337">http://localhost:1337</a></p>

<h2 id="crear-un-repositorio-git">Crear un repositorio git</h2>
<p><img class="pull-right" src="http://git-scm.com/images/logo@2x.png" title="'Git'" />
Es muy recomendable tener un control de versiones aunque sea simplemente en local para poder deshacer cambios y tener un flujo de trabajo controlado.</p>

<div>
  <pre><code class="plain">$ git init</code></pre>
</div>

<p>Además, quién sabe si mañana no eres tú solo el que toca el código. Así que, inicializamos un git y enviamos lo que llevamos. Os recomiendo echarle un ojo al <a href="http://nvie.com/posts/a-successful-git-branching-model/">modelo de ramificación Git acertado</a>.</p>

<p><img class="center" src="http://nvie.com/img/2009/12/Screen-shot-2009-12-24-at-11.32.03.png" title="'A successful Git branching model'" /></p>

<p>De momento vamos a crear únicamente las ramas <code>master</code> y <code>develop</code> para nuestro proyecto y según vayamos necesitando las demás las vamos creando a partir de la rama que corresponda.</p>

<div>
  <pre><code class="plain">$ git checkout -b master &amp;&amp; git checkout -b develop</code></pre>
</div>

<p>De esta manera nos quedamos en la rama <code>develop</code> para empezar ahí nuestro proyecto y cuando tengamos algo estable lo combinaremos con la rama <code>master</code>.</p>

<h3 id="repositorio-git-remoto-en-github">Repositorio git remoto en GitHub</h3>
<p>En mi caso, voy a usar <a href="http://github.com">GitHub</a> para compartir mi código con todos vosotros. Creamos nuestro nuevo repositorio en GitHub e incluimos la url del repositorio a nuestro proyecto:</p>

<div>
  <pre><code class="plain">$ git remote add origin &lt;git_url&gt;</code></pre>
</div>

<h3 id="primer-commit">Primer commit</h3>
<p>Ahora que tenemos nuestro repositorio git es hora de hacer el primer commit:</p>

<div>
  <pre><code class="plain">$ git add .
$ git commit -m &quot;First commit&quot;
$ git push -u origin develop</code></pre>
</div>

<h2 id="despliegue-en-heroku">Despliegue en Heroku</h2>
<p><img class="pull-right" src="https://d1lpkba4w1baqt.cloudfront.net/heroku-logo-light-300x100.png" title="'Heroku'" />
Una vez tenemos nuestro proyecto en local vamos a ver si nos funciona correctamente en el servidor de producción. Voy a describir los pasos claves, pero si tienes algún problema puedes echarle un ojo <a href="https://devcenter.heroku.com/articles/getting-started-with-nodejs">Empezar con Node.js en Heroku</a> y <a href="https://devcenter.heroku.com/articles/git">Desplegando con git</a> para obtener información adicional.</p>

<h3 id="requisitos-1">Requisitos</h3>
<p>Antes de empezar necesitaremos un par de cosas:</p>

<ol>
  <li><a href="https://id.heroku.com/signup/devcenter">Crear una cuenta en Heroku</a></li>
  <li>Instalar las <a href="https://toolbelt.heroku.com/">Heroku Toolbelt</a></li>
</ol>

<h3 id="configuracin-local">Configuración local</h3>
<p>Después de instalar las Toolbelt tendrás disponible el comando <code>heroku</code> en tu consola. Así que vamos a registrarnos en Heroku y configurar nuestro entorno:</p>

<div>
  <pre><code class="shell">$ heroku login</code></pre>
</div>

<p>Nos pedirá nuestro nombre de usuario, contraseña y si queremos crear una llave pública SSH (<em>SSH public key</em>) para poder publicar nuestro código posteriormente.</p>

<p>Es recomendable indicar en el &#8220;`package.json&#8220; la versión de node que queremos utilizar para evitar problemas y asegurarnos que estamos usando una versión que soportamos.</p>

<p>~~~ json
“engines”: {
    “node”: “0.10.x”
}
~~</p>

<p>Heroku usa el fichero <em>Procfile</em> para indicar los comandos que va a ejecutar la aplicación, así que le tenemos que indicar que queremos un comando de tipo web y que ejecute nuestro script de Node.js:</p>

<div>
  <pre><code class="plain">web: node app.js</code></pre>
</div>

<p>Ahora podemos arrancar la aplicación usando <a href="https://github.com/ddollar/foreman">Foreman</a>, que también lo tendrás instalado como parte de las ToolBelt:</p>

<div>
  <pre><code class="shell">$ foreman start</code></pre>
</div>

<p>Seguramente te de un error porque no encuentra el módulo <code>sails</code>, así que instala las dependencias para tener una copia de sails en node_modules, puesto que al tenerlo instalado globalmente foreman no lo encuentra.</p>

<div>
  <pre><code class="shell">$ npm install</code></pre>
</div>

<p>Si todo funciona correctamente, subimos nuestro nuevo fichero al repositorio:</p>

<div>
  <pre><code class="plain">$ git add .
$ git commit -m &quot;Added Procfile&quot;
$ git push origin develop</code></pre>
</div>

<h3 id="crear-una-aplicacin-en-heroku">Crear una aplicación en Heroku</h3>
<p>Heroku utiliza git para la gestión del código, así que tendremos que crear la aplicación en Heroku y poner una referencia en nuestra lista de repositorios remotos.</p>

<div>
  <pre><code class="shell">$ heroku apps:create &lt;appName&gt; --remote &lt;remote&gt; --region eu</code></pre>
</div>

<p>Esto creará una aplicación <code>&lt;appName&gt;</code> en Heroku, creará un repositorio remoto llamado <code>&lt;remote&gt;</code> (por defecto, heroku) e indicamos que nuestra región es Europa.</p>

<p>Si tenemos la aplicación creada en Heroku, podemos añadirla como repositorio remoto:</p>
<div>
  <pre><code class="shell">$ heroku git:remote -a &lt;appName&gt;</code></pre>
</div>

<p>Debido a que tenemos la rama maestra y la de desarrollo, y Heroku sólo tiene en cuenta la rama master para los despliegues en sus servidores, recomiendo crear otra app en Heroku para desarrollo. Yo lo he hecho añadiendo <code>-dev</code> tanto al nombre de la app con al nombre del repositorio remoto.</p>

<div>
  <pre><code class="shell">$ heroku apps:create &lt;appName&gt;-dev --remote &lt;remote&gt;-dev --region eu</code></pre>
</div>

<h3 id="desplegar-el-cdigo">Desplegar el código</h3>
<p><img class="pull-left no-border" src="http://sailsjs.org/images/image_devInTub.png" title="'Sails lift'" />
Hasta ahora solo hemos subido el código a la rama <code>develop</code> por lo que tendremos que desplegar en la rama master de <code>heroku-dev</code>.</p>

<div>
  <pre><code class="shell">$ git push heroku-dev develop:master</code></pre>
</div>

<p>Veremos cómo detecta que es una aplicación Node.js, instala las dependencias, cachea node_modules para futuros despliegues, construye el entorno, parsea el Procfile comprime y lanza. Ahora podemos ver nuestra webapp en el entorno de pre-producción <a href="http://building-realtime-webapp-dev.herokuapp.com">http://building-realtime-webapp-dev.herokuapp.com</a></p>
</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="glyphicon glyphicon-user"></span> <span class="byline author vcard">Posted by <span class="fn">Jorge del Casar</span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-01-10T10:30:09+01:00" pubdate data-updated="true">Jan 10<span>th</span>, 2014</time>
          

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/blog/categories/sailsjs/'>SailsJS</a>
  
</span>


        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://jorgecasar.github.io/blog/desarrollar-webapps-realtime-creacion/" data-via="jorgecasar" data-counturl="http://jorgecasar.github.io/blog/desarrollar-webapps-realtime-creacion/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/blog/como-crear-tu-blog-en-github-pages/" title="Previous Post: Cómo crear tu blog en GitHub Pages">&laquo; Cómo crear tu blog en GitHub Pages</a></li>
            
            
            <li class="next"><a href="/blog/desarrollar-webapps-realtime-usuarios/" title="Next Post: Desarrollar Webapps Realtime: Usuarios">Desarrollar Webapps Realtime: Usuarios &raquo;</a></li>
            
          </ul>
        
      </footer>
    </article>
    
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
      </section>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/desarrollar-webapps-realtime-auth-con-passport-y-proveedores/">Desarrollar Webapps Realtime: Auth Con Passport Y Proveedores</a>
    
    <a class="list-group-item " href="/blog/desarrollar-webapps-realtime-auth-con-passport/">Desarrollar Webapps Realtime: Auth Con Passport</a>
    
    <a class="list-group-item " href="/blog/desarrollar-webapps-realtime-auth/">Desarrollar Webapps Realtime: Auth</a>
    
    <a class="list-group-item " href="/blog/desarrollar-webapps-realtime-usuarios/">Desarrollar Webapps Realtime: Usuarios</a>
    
    <a class="list-group-item active" href="/blog/desarrollar-webapps-realtime-creacion/">Desarrollar Webapps Realtime: Creación</a>
    
  </div>
</section>

<section class="panel panel-default clearfix">
  <div class="panel-heading">
      <h3 class="panel-title">GitHub Repos</h3>
  </div>
  <div class="list-group" id="gh_repos">
    <p class="loading">Status updating...</p>
  </div>
  
    <div class="gh-profile-link pull-right text-muted">
      <a href="https://github.com/jorgecasar">@jorgecasar</a> on GitHub
    </div>
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jorgecasar',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">On Delicious</h3>
  </div>
  <div class="panel-body">
    <div id="delicious"></div>
    <script type="text/javascript" src="http://feeds.delicious.com/v2/json/jorgecasar?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
    <p><a href="http://delicious.com/jorgecasar">My Delicious Bookmarks &raquo;</a></p>
  </div>
</section>



<section class="googleplus panel panel-default">
  <div class="panel-body">
    <h1>
      <a href="https://plus.google.com/+JorgeDelCasarSanchez?rel=author">
        <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
        Google+
      </a>
    </h1>
  </div>
</section>



    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2014 - Jorge del Casar<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'jorgecasar';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jorgecasar.github.io/blog/desarrollar-webapps-realtime-creacion/';
        var disqus_url = 'http://jorgecasar.github.io/blog/desarrollar-webapps-realtime-creacion/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </body>
</html>
