---
import { Picture } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import { getLangFromUrl, useTranslatedPath } from "../i18n/utils.ts";

const lang = getLangFromUrl(Astro.url);
const translatePath = useTranslatedPath(lang);

interface Props {
	talk: CollectionEntry<"talks">;
}

const { data, slug } = Astro.props.talk;
const [, ...talkSlug] = slug.split("/");

const widths = [360, 600]
	.reduce((acc, curr) => [...acc, curr, curr * 2, curr * 3], [data.img.width])
	.filter((value, index, all) => all.indexOf(value) === index)
	.sort((a, b) => a - b);
---

<a class="card" href=`${translatePath('/talks', lang)}/${talkSlug}/`>
	<span class="title">{data.title}</span>
	<Picture
		formats={["avif", "webp"]}
		loading="eager"
		src={data.img as ImageMetadata}
		width={widths[0]}
		widths={widths}
		alt={data.imgAlt}
		sizes="(min-width: 1400px) 606px, (min-width: 800px) calc(45.52vw - 22px), calc(100vw - 50px)"
	/>

	<style>
		.card {
			display: grid;
			grid-template: auto 1fr / auto 1fr;
			height: 11rem;
			background: var(--gradient-subtle);
			border: 1px solid var(--gray-800);
			border-radius: 0.75rem;
			overflow: hidden;
			box-shadow: var(--shadow-sm);
			text-decoration: none;
			font-family: var(--font-brand);
			font-size: var(--text-lg);
			font-weight: 500;
			transition: box-shadow var(--theme-transition);
		}

		.card:hover {
			box-shadow: var(--shadow-md);
		}

		.title {
			grid-area: 1 / 1 / 2 / 2;
			z-index: 1;
			margin: 0.5rem;
			padding: 0.5rem 1rem;
			background: var(--gray-999);
			color: var(--gray-200);
			border-radius: 0.375rem;
		}

		.card :global(picture) {
			grid-area: 1 / 1 / 3 / 3;
		}

		img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		@media (min-width: 50em) {
			.card {
				height: 22rem;
				border-radius: 1.5rem;
			}

			.title {
				border-radius: 0.9375rem;
			}
		}
	</style>
</a>
